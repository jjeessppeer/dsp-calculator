<!DOCTYPE html>
<html lang="en">

<head>
  <title>DSP Calculator</title>
  <link rel="icon" href="/item_images/t-matrix.png" type="image/x-icon" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <script src="https://unpkg.com/mathjs@9.2.0/lib/browser/math.js" type="text/javascript"></script>
  <script src="https://unpkg.com/javascript-lp-solver/prod/solver.js"></script>
    
  <script src="elements.js"></script>
  <script src="utils.js"></script>
  <script src="solve_factory.js"></script>

  
  <link rel="stylesheet" href="mystyle.css">
  <link rel="stylesheet" href="input-list.css">
  <link rel="stylesheet" href="tabs.css">
  <link rel="stylesheet" href="production-table.css">
  <link rel="stylesheet" href="settings.css">

</head>

<body>

  <div class="contentBox">
    <h3>Output Items</h5>
    <ul id="outputItems" class="outputItems">
      <li>
        <button id="addInputBtn">+</button>
      </li>
    </ul>
  </div>

  <br>
  <br>

  <div id="tabs">
    <button data-page="results-page" class="tab-btn active">Results</button>
    <button data-page="settings-page" class="tab-btn">Settings</button>
  </div>

  <div id="results-page" class="tab-page active">
    <table id="resultsTable" class="resultsTable">
      <thead>
        <tr class="header-row">
          <th colspan="2">items/s</th>
          <th colspan="2">belts</th>
          <th colspan="2">machines</th>
          <th colspan="1">power</th>
        </tr>
      </thead>
      
      <tbody class="item-row">
        <tr>
          <td><img src="item_images/copper-ore.png"></td>
          <td class="pad">1.5</td>
          <td><img src="item_images/belt-1.png"></td>
          <td class="pad">&times; 1.5</td>
          <td><img src="item_images/assembler-1.png"></td>
          <td class="pad">&times; 1.5</td>
          <td>100kW</td>
        </tr>
      </tbody>
      

    </table>
  </div>
  <div id="settings-page" class="tab-page">
    <table>
      <tr>
        <td>Assembler type:</td>
        <td id="assembler-selection">
          <img class="active" data-type="0" src="item_images/assembler-1.png">
          <img data-type="1" src="item_images/assembler-2.png">
          <img data-type="2" src="item_images/assembler-3.png">
        </td>
      </tr>
      <tr>
        Hydrogen source:
      </tr>
      <tr>
        Graphite source:
      </tr>
    </table>
  </div>
  



  <script>
    var datasets_loaded = 0
    var items, machines, recepies, belts;
    var SETTINGS = {
      'machines': {
        'SMELT': 0,
        'CHEMICAL': 0,
        'REFINE': 0,
        'ASSEMBLE': 1,
        'PARTICLE': 0,
        'EXCHANGE': 0,
        'PHOTON_CAPTURE': 0,
        'PHOTON_STORE': 0,
        'RESEARCH': 0,
        'GATHER': 0,
        'MINE': 0,
        'PUMP': 0,
        'ORBITAL_COLLECT': 0,
        'OIL_EXTRACT': 0
      },
      belt: 0,
      specials: {
        'thing': false
      }
    }
    
    fetch('data/items.json').then(response => response.json()).then(data => {
      items = data;
      datasets_loaded++;
      if (datasets_loaded == 4) initialize();
    });
    fetch('data/machines.json').then(response => response.json()).then(data => {
      machines = data;
      datasets_loaded++;
      if (datasets_loaded == 4) initialize();
    });
    fetch('data/recepies.json').then(response => response.json()).then(data => {
      recepies = data;
      datasets_loaded++;
      if (datasets_loaded == 4) initialize();
    });
    fetch('data/belts.json').then(response => response.json()).then(data => {
      belts = data;
      datasets_loaded++;
      if (datasets_loaded == 4) initialize();
    });


    function initialize(){
      console.log("INITIALIZING")
      document.getElementById("addInputBtn").addEventListener('click', addInputRow);
      var active_machines = {};
      for (const machine in machines){
        active_machines[machine] = 0
      }

      addInputRow()
    }


    function addInputRow(){
      let listel = document.createElement('li', {is: 'input-item'});
      let btn = document.getElementById('addInputBtn');
      btn.parentNode.insertBefore(listel, btn);
      // reloadResultsTable()
    }


    // addInputRow();

    document.querySelectorAll('.tab-btn').forEach(element => { 
      element.addEventListener('click', tabClicked); });

    function tabClicked(event) {
      document.querySelector('.tab-page.active').classList.remove('active');
      document.getElementById(event.target.dataset.page).classList.add('active');
      document.querySelector('.tab-btn.active').classList.remove('active');
      event.target.classList.add('active');
    }


    
    
    // document.querySelector(".resultsTable").addEventListener('click', addInputRow);

    window.addEventListener('click', function (event) {
        var dropdowns = document.querySelectorAll(".dropdown");
        for (let i = 0; i < dropdowns.length; i++) {
          if (dropdowns[i].querySelector(".dropbtn") == event.target) continue;
          dropdowns[i].classList.remove('active');
        }
    })


  </script>

<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script> -->


</html>